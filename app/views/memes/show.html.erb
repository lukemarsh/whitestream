<% content_for :title do %><%= @meme.page_title %><% end %>
<div class="row" id="meme">
  <div class="col-md-8" id="left">
    <%= image_tag @meme.image, :class => "single-meme" %>
    <div class="details">
      <span>By <%= @meme.user.username %></span> | <span><%= @meme.created_at.to_formatted_s(:month_and_year) %></span>
    </div>
    <div id="share-buttons">
      <span id="like">
        <iframe src="//www.facebook.com/plugins/like.php?href=<%= request.original_url %>&amp;width&amp;layout=button_count&amp;action=like&amp;show_faces=false&amp;share=true&amp;height=21&amp;appId=568398906591962" scrolling="no" frameborder="0" style="border:none; overflow:hidden; height:21px;" allowTransparency="true"></iframe>
      </span>
      <span id="tweet">
        <a href="https://twitter.com/share" class="twitter-share-button" data-url="<%= request.original_url %>" data-text="Check out this article on World Edit">
        Tweet</a>
      </span>
      <span id="plusone">
        <div class="g-plusone" data-size="medium" data-href="<%= request.original_url %>"></div>
      </span>
      <span id="tumblr">
        <a href="http://www.tumblr.com/share/link?url=<%= request.original_url.gsub! 'http://', '' %>" title="Share on Tumblr" style="display:inline-block; text-indent:-9999px; overflow:hidden; width:81px; height:20px; background:url('http://platform.tumblr.com/v1/share_1.png') top left no-repeat transparent;">Share on Tumblr</a>
      </span>
      <div id="reddit">
        <script type="text/javascript" src="http://www.reddit.com/buttonlite.js?i=5&url=<%= request.original_url %>"></script>
      </div>
    </div>
    <div id="article">
      <%= raw(@meme.article) %>
    </div>
  </div>
  <div class="col-md-4" id="right">
    <ul class="actions">
      <% if @meme.user == current_user || current_admin %>
        <li><%= link_to '', @meme, :method => :delete, :class => "glyphicon glyphicon-trash",  data: {confirm: "Are you sure you want to delete this article?"} %> Delete article</li>
      <% end %>
      <% if current_admin %>
        <% if meme.featured %>
          <li><%= link_to meme_unfeature_path(meme), :method => :delete, :class => "feature" do %>
            <span class="glyphicon glyphicon-star"></span></li>
          <% end %>
        <% else %>
          <li><%= link_to meme_feature_path(meme), :method => :post, :class => "feature" do %>
            <span class="glyphicon glyphicon-star"></span></li>
          <% end %>
        <% end %>
      <% end %>
      <li class="views">
        <span class="glyphicon glyphicon-eye-open"></span> <%= pluralize(@meme.impressionist_count, 'view') %>
      </li>
      <li class="comments">
        <span class="glyphicon glyphicon-comment"></span> <%= pluralize(@meme.comments.count, 'comment') %>
      </li>
      <% if @current_user %>
        <li class="like" id="meme_<%= @meme.id %>">
          <%= render partial: 'memes/like', locals: {meme: @meme} %>
        </li>
      <% end %>
    </ul>
    <h3>Comments</h3>
    <div id="comments">
      <ul>
        <% if @comments.length > 0 %>
          <% for comment in @comments %>
            <li class="comment">
              <% if comment.user %>
                <%= image_tag avatar_url(comment.user) %>
                <div class="text">
                  <% if comment.user == current_user %>
                    <div class="actions">
                      <%= link_to '', '#', :class => "glyphicon glyphicon-pencil", :id => "edit-" + comment.id.to_s %>
                      <%= link_to '', meme_comment_path(@meme, comment), :method => :delete, :class => "glyphicon glyphicon-remove",  data: {confirm: "Are you sure you want to delete this comment?"} %>
                    </div>
                  <% end %>
                  <h4><%= link_to comment.user do %>
                    <%= comment.user.username %>
                  <% end %>
                  </h4>
                  <p><%= best_in_place comment, :comment, :activator => '#edit-' + comment.id.to_s, :path => meme_comment_path(@meme, comment), :type => 'textarea' %></p>
                  <p class="date"><%= comment.created_at.to_formatted_s(:month_and_year) %></p>
                </div>
              <% end %>
            </li>
          <% end %>
        <% end %>
      </ul>
      <% if current_user %>
        <%= form_for [@meme, @comment] do |f| %>
          <%= f.text_area :comment, :class => 'form-control', :placeholder => "Write a comment..." %>
          <br>
          <%= f.submit 'Submit', :class => 'btn btn-default btn-sm' %>
        <% end %>
      <% else %>
        <p><%= link_to 'Log in', new_user_session_path %> to post a comment</p>
      <% end %>
    </div><br>
    <% if @memes.length > 0 %>
      <h3>More from this user</h3>
      <%= render partial: 'memes/memes', locals: {memes: @memes} %>
    <% end %>
  </div>
  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-body">
          <img src="" alt="" width="100%" class="modal-meme">
          <div id="social-share-buttons">
            <span id="like"></span>
            <span id="tweet"></span>
            <span id="plusone"></span>
            <span id="tumblr"></span>
            <div id="reddit"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>